# Android 待办事项清单（To-Do List）应用开发实验报告

## 一、实验基本信息

### 1. 实验名称

基于 ListView 的 Android 待办事项清单应用开发

### 2. 实验目的

-   掌握 Android 中 ListView 控件的基本使用方法，理解列表视图的展示逻辑；
-   学会自定义 ArrayAdapter 适配器，实现数据模型与列表项视图的绑定；
-   熟悉 LinearLayout 线性布局的设计与使用，掌握常用 UI 组件（EditText、Button、ImageView、TextView）的属性配置；
-   解决 Android 开发中资源引用、命名空间、系统兼容性等常见编译错误；
-   实现简单的用户交互功能（添加任务），理解数据驱动视图更新的核心思想。

### 3. 实验环境

-   开发工具：Android Studio Hedgehog | 2023.1.1
-   目标 SDK 版本：Android 14（API Level 34）
-   最小 SDK 版本：Android 7.0（API Level 24）
-   运行环境：Android 模拟器（Pixel 6，Android 13 API 33）
-   开发语言：Java
-   构建工具：Gradle 8.2

## 二、实验原理

1.  **ListView 核心机制**：ListView 是 Android 用于展示滚动列表的核心控件，通过适配器（Adapter）实现 “数据 - 视图” 解耦，适配器负责将数据模型中的数据绑定到列表项视图，并实现视图复用以提升性能。
2.  **Adapter 工作流程**：自定义 ArrayAdapter 继承自系统 ArrayAdapter 类，重写 `getView()` 方法，完成列表项视图的加载、控件绑定、数据赋值，同时复用 convertView 减少内存开销。
3.  **交互逻辑**：通过监听 Button 点击事件，获取 EditText 输入内容，更新数据集合后调用 Adapter 的 `notifyDataSetChanged()` 方法刷新列表。

## 三、实验步骤与核心代码

### 3.1 创建 Android 项目

新建 Empty Activity 项目，配置如下：

-   项目名称：ToDoListApp
-   包名：com.example.todolistapp
-   语言：Java
-   最低 SDK：API 24（Android 7.0）

### 3.2 定义数据模型（TaskItem.java）

创建 `TaskItem` 类封装待办任务属性，包含任务名称、截止日期、是否为重要任务（星星标记）。

java

运行

```java
package com.example.todolistapp;

/**
 * 待办任务数据模型
 */
public class TaskItem {
    // 任务名称
    private String taskName;
    // 截止日期
    private String dueDate;
    // 是否为重要任务（星星标记）
    private boolean isImportant;

    // 构造方法
    public TaskItem(String taskName, String dueDate, boolean isImportant) {
        this.taskName = taskName;
        this.dueDate = dueDate;
        this.isImportant = isImportant;
    }

    // Getter 方法（Adapter 需要获取数据）
    public String getTaskName() {
        return taskName;
    }

    public String getDueDate() {
        return dueDate;
    }

    public boolean isImportant() {
        return isImportant;
    }
}
```

### 3.3 设计布局文件

#### 3.3.1 自定义颜色资源（res/values/colors.xml）

解决系统颜色兼容性问题，定义自定义黄色用于星星标记。

xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <!-- 星星标记黄色 -->
    <color name="star_yellow">#FFD700</color>
    <!-- 输入框边框颜色 -->
    <color name="edittext_border">#616161</color>
    <!-- 输入框背景色 -->
    <color name="edittext_bg">#FFFFFF</color>
</resources>
```

#### 3.3.2 输入框圆角背景（res/drawable/edittext_bg.xml）

优化输入框样式，添加圆角和边框。

xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android"
    android:shape="rectangle">
    <!-- 圆角 -->
    <corners android:radius="8dp"/>
    <!-- 边框 -->
    <stroke
        android:width="1dp"
        android:color="@color/edittext_border"/>
    <!-- 背景色 -->
    <solid android:color="@color/edittext_bg"/>
</shape>
```

#### 3.3.3 列表项布局（res/layout/list_item_task.xml）

定义单个任务项的展示样式，包含星星图标、任务名称、截止日期。

xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="horizontal"
    android:padding="16dp"
    android:gravity="center_vertical"
    android:background="?android:attr/selectableItemBackground">

    <!-- 重要任务星星图标 -->
    <ImageView
        android:id="@+id/iv_star"
        android:layout_width="24dp"
        android:layout_height="24dp"
        android:src="@android:drawable/star_big_on"
        app:tint="@color/star_yellow"
        android:layout_marginEnd="12dp"/>

    <!-- 任务信息容器 -->
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical">

        <!-- 任务名称 -->
        <TextView
            android:id="@+id/tv_task_name"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:textSize="18sp"
            android:textStyle="bold"/>

        <!-- 截止日期 -->
        <TextView
            android:id="@+id/tv_due_date"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:textSize="14sp"
            android:textColor="@android:color/darker_gray"
            android:layout_marginTop="4dp"/>

    </LinearLayout>

</LinearLayout>
```

#### 3.3.4 主界面布局（res/layout/activity_main.xml）

包含任务输入框、添加按钮和任务列表 ListView。

xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:padding="16dp">

    <!-- 任务输入与添加区域 -->
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:gravity="center_vertical"
        android:layout_marginBottom="16dp">

        <!-- 任务名称输入框 -->
        <EditText
            android:id="@+id/et_task_input"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:hint="请输入任务名称"
            android:padding="12dp"
            android:background="@drawable/edittext_bg"
            android:singleLine="true"/>

        <!-- 添加任务按钮 -->
        <Button
            android:id="@+id/btn_add_task"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="Add Task"
            android:layout_marginStart="8dp"
            android:paddingHorizontal="16dp"/>

    </LinearLayout>

    <!-- 待办任务列表 -->
    <ListView
        android:id="@+id/lv_tasks"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:divider="@android:color/darker_gray"
        android:dividerHeight="1dp"/>

</LinearLayout>
```

### 3.4 实现自定义适配器（TaskAdapter.java）

继承 ArrayAdapter 类，完成数据模型与列表项视图的绑定，实现视图复用。

java

运行

```java
package com.example.todolistapp;

import android.content.Context;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;
import android.widget.ImageView;
import android.widget.TextView;

import java.util.ArrayList;

/**
 * 待办任务列表适配器
 */
public class TaskAdapter extends ArrayAdapter<TaskItem> {

    // 构造方法
    public TaskAdapter(Context context, ArrayList<TaskItem> taskList) {
        super(context, 0, taskList);
    }

    @Override
    public View getView(int position, View convertView, ViewGroup parent) {
        // 1. 获取当前位置的任务数据
        TaskItem task = getItem(position);

        // 2. 视图复用：若convertView为空，加载列表项布局
        if (convertView == null) {
            convertView = LayoutInflater.from(getContext())
                    .inflate(R.layout.list_item_task, parent, false);
        }

        // 3. 获取列表项中的控件
        ImageView ivStar = convertView.findViewById(R.id.iv_star);
        TextView tvTaskName = convertView.findViewById(R.id.tv_task_name);
        TextView tvDueDate = convertView.findViewById(R.id.tv_due_date);

        // 4. 绑定数据到控件
        tvTaskName.setText(task.getTaskName());
        tvDueDate.setText("截止日期：" + task.getDueDate());
        // 重要任务显示星星，非重要任务隐藏星星
        ivStar.setVisibility(task.isImportant() ? View.VISIBLE : View.GONE);

        // 5. 返回填充数据后的视图
        return convertView;
    }
}
```

### 3.5 主界面逻辑实现（MainActivity.java）

完成数据初始化、适配器绑定、添加任务交互逻辑。

java

运行

```java
package com.example.todolistapp;

import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ListView;
import android.widget.Toast;

import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.Locale;

public class MainActivity extends AppCompatActivity {

    // 任务列表数据集合
    private ArrayList<TaskItem> taskList;
    // 任务列表适配器
    private TaskAdapter taskAdapter;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        // 1. 获取界面控件
        EditText etTaskInput = findViewById(R.id.et_task_input);
        Button btnAddTask = findViewById(R.id.btn_add_task);
        ListView lvTasks = findViewById(R.id.lv_tasks);

        // 2. 初始化示例任务数据
        initTaskData();

        // 3. 创建适配器并绑定到ListView
        taskAdapter = new TaskAdapter(this, taskList);
        lvTasks.setAdapter(taskAdapter);

        // 4. 绑定“添加任务”按钮点击事件
        btnAddTask.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                // 获取输入的任务名称
                String taskName = etTaskInput.getText().toString().trim();
                // 校验输入是否为空
                if (taskName.isEmpty()) {
                    Toast.makeText(MainActivity.this, "请输入任务名称！", Toast.LENGTH_SHORT).show();
                    return;
                }

                // 获取当前日期作为默认截止日期
                SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd", Locale.getDefault());
                String currentDate = sdf.format(new Date());

                // 添加新任务到数据集合（默认非重要任务）
                taskList.add(new TaskItem(taskName, currentDate, false));
                // 通知适配器数据更新，刷新列表
                taskAdapter.notifyDataSetChanged();

                // 清空输入框
                etTaskInput.setText("");
                Toast.makeText(MainActivity.this, "任务添加成功！", Toast.LENGTH_SHORT).show();
            }
        });
    }

    /**
     * 初始化示例任务数据
     */
    private void initTaskData() {
        taskList = new ArrayList<>();
        taskList.add(new TaskItem("Complete Android Homework", "2025-12-20", true));
        taskList.add(new TaskItem("Buy groceries", "2024-05-01", false));
        taskList.add(new TaskItem("Walk the dog", "2024-04-20", false));
        taskList.add(new TaskItem("Call John", "2024-04-23", true));
    }
}
```


