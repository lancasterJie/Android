


# Android本地数据持久化综合实验报告

## 一、实验目标

通过本实验，掌握Android中三种常用本地数据存储方式：
1. 文件（File）读写操作
2. SharedPreferences键值对存储
3. SQLite数据库管理

## 二、实验环境

- 操作系统：Windows 11
- 开发工具：Android Studio Giraffe
- 编程语言：Java
- 目标SDK：Android API 33
- 测试设备：Android虚拟设备（Pixel 4 API 33）

## 三、实验内容与实现

### 3.1 项目结构
```
app/
├── src/main/java/com/example/thirdtask/
│   ├── MainActivity.java          # 主界面
│   ├── SettingsActivity.java      # 设置界面
│   ├── RecordListActivity.java    # 记录列表
│   ├── DetailActivity.java        # 详情界面
│   ├── MyDbHelper.java           # 数据库帮助类
│   ├── Record.java               # 记录实体类
│   └── RecordDao.java            # 数据库操作类
├── src/main/res/
│   ├── layout/                   # 布局文件
│   ├── menu/                     # 菜单资源
│   └── values/                   # 资源文件
```

### 3.2 核心代码实现

#### 3.2.1 文件读写模块

**核心代码（MainActivity.java）：**

```java
// 保存到文件
private void saveToFile() {
    String text = editTextNote.getText().toString();
    if (TextUtils.isEmpty(text)) {
        Toast.makeText(this, "请输入内容", Toast.LENGTH_SHORT).show();
        return;
    }
    
    try {
        // 使用openFileOutput写入文件
        FileOutputStream fos = openFileOutput("note.txt", MODE_PRIVATE);
        fos.write(text.getBytes());
        fos.close();
        Toast.makeText(this, "保存成功", Toast.LENGTH_SHORT).show();
    } catch (IOException e) {
        e.printStackTrace();
        Toast.makeText(this, "保存失败: " + e.getMessage(), Toast.LENGTH_SHORT).show();
    }
}

// 从文件加载
private void loadFromFile() {
    try {
        // 使用openFileInput读取文件
        FileInputStream fis = openFileInput("note.txt");
        BufferedReader reader = new BufferedReader(new InputStreamReader(fis));
        StringBuilder sb = new StringBuilder();
        String line;
        while ((line = reader.readLine()) != null) {
            sb.append(line).append("\n");
        }
        reader.close();
        fis.close();
        
        editTextNote.setText(sb.toString());
        Toast.makeText(this, "加载成功", Toast.LENGTH_SHORT).show();
    } catch (IOException e) {
        e.printStackTrace();
        Toast.makeText(this, "文件不存在或读取失败", Toast.LENGTH_SHORT).show();
    }
}
```

#### 3.2.2 SharedPreferences模块

**核心代码（SettingsActivity.java）：**

```java
// 加载设置
private void loadSettings() {
    SharedPreferences sp = getSharedPreferences("settings", MODE_PRIVATE);
    boolean autoSave = sp.getBoolean("auto_save", false);
    String userName = sp.getString("user_name", "");
    String password = sp.getString("password", "");
    
    checkBoxAutoSave.setChecked(autoSave);
    editTextUserName.setText(userName);
    editTextPassword.setText(password);
}

// 保存设置
private void saveSettings() {
    SharedPreferences sp = getSharedPreferences("settings", MODE_PRIVATE);
    SharedPreferences.Editor editor = sp.edit();
    editor.putBoolean("auto_save", checkBoxAutoSave.isChecked());
    editor.putString("user_name", editTextUserName.getText().toString());
    editor.putString("password", editTextPassword.getText().toString());
    editor.apply();
}
```

#### 3.2.3 SQLite数据库模块

**核心代码（MyDbHelper.java）：**

```java
public class MyDbHelper extends SQLiteOpenHelper {
    private static final String DB_NAME = "myapp.db";
    private static final int DB_VERSION = 1;
    
    public static final String TABLE_RECORDS = "records";
    public static final String COLUMN_ID = "_id";
    public static final String COLUMN_TITLE = "title";
    public static final String COLUMN_CONTENT = "content";
    public static final String COLUMN_TIME = "time";

    public MyDbHelper(Context context) {
        super(context, DB_NAME, null, DB_VERSION);
    }

    @Override
    public void onCreate(SQLiteDatabase db) {
        String sql = "CREATE TABLE " + TABLE_RECORDS + " (" +
                COLUMN_ID + " INTEGER PRIMARY KEY AUTOINCREMENT," +
                COLUMN_TITLE + " TEXT," +
                COLUMN_CONTENT + " TEXT," +
                COLUMN_TIME + " TEXT)";
        db.execSQL(sql);
    }

    @Override
    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
        db.execSQL("DROP TABLE IF EXISTS " + TABLE_RECORDS);
        onCreate(db);
    }
}
```

**核心代码（RecordDao.java - 增删改查操作）：**

```java
// 添加记录
public long addRecord(Record record) {
    SQLiteDatabase db = dbHelper.getWritableDatabase();
    ContentValues values = new ContentValues();
    values.put(MyDbHelper.COLUMN_TITLE, record.getTitle());
    values.put(MyDbHelper.COLUMN_CONTENT, record.getContent());
    values.put(MyDbHelper.COLUMN_TIME, record.getTime());
    
    long id = db.insert(MyDbHelper.TABLE_RECORDS, null, values);
    db.close();
    return id;
}

// 获取所有记录
public List<Record> getAllRecords() {
    List<Record> records = new ArrayList<>();
    SQLiteDatabase db = dbHelper.getReadableDatabase();
    
    String[] columns = {
        MyDbHelper.COLUMN_ID,
        MyDbHelper.COLUMN_TITLE,
        MyDbHelper.COLUMN_CONTENT,
        MyDbHelper.COLUMN_TIME
    };
    
    Cursor cursor = db.query(
        MyDbHelper.TABLE_RECORDS,
        columns,
        null, null, null, null,
        MyDbHelper.COLUMN_TIME + " DESC"
    );
    
    while (cursor.moveToNext()) {
        Record record = new Record();
        record.setId(cursor.getInt(cursor.getColumnIndexOrThrow(MyDbHelper.COLUMN_ID)));
        record.setTitle(cursor.getString(cursor.getColumnIndexOrThrow(MyDbHelper.COLUMN_TITLE)));
        record.setContent(cursor.getString(cursor.getColumnIndexOrThrow(MyDbHelper.COLUMN_CONTENT)));
        record.setTime(cursor.getString(cursor.getColumnIndexOrThrow(MyDbHelper.COLUMN_TIME)));
        records.add(record);
    }
    
    cursor.close();
    db.close();
    return records;
}

// 删除记录
public int deleteRecord(int id) {
    SQLiteDatabase db = dbHelper.getWritableDatabase();
    int result = db.delete(
        MyDbHelper.TABLE_RECORDS,
        MyDbHelper.COLUMN_ID + " = ?",
        new String[]{String.valueOf(id)}
    );
    db.close();
    return result;
}
```

#### 3.2.4 实体类设计

```java
public class Record {
    private int id;
    private String title;
    private String content;
    private String time;

    // 构造函数
    public Record() {}
    
    public Record(int id, String title, String content, String time) {
        this.id = id;
        this.title = title;
        this.content = content;
        this.time = time;
    }

    // Getter和Setter方法
    public int getId() { return id; }
    public void setId(int id) { this.id = id; }
    
    public String getTitle() { return title; }
    public void setTitle(String title) { this.title = title; }
    
    public String getContent() { return content; }
    public void setContent(String content) { this.content = content; }
    
    public String getTime() { return time; }
    public void setTime(String time) { this.time = time; }
}
```





---


