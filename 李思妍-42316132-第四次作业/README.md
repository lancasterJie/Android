# Android 本地数据持久化实验

## 项目简介

这是一个完整的 Android 本地数据持久化实验应用，实现了三种主要的数据存储方式：
- **文件存储**：使用 FileInputStream/FileOutputStream 进行文本文件读写
- **SharedPreferences**：存储用户设置和配置信息
- **SQLite 数据库**：使用 SQLiteOpenHelper 进行结构化数据存储

## 功能模块

### 1. 文件读写模块
- 文本编辑区域：支持多行文本输入
- 保存到文件：将编辑框内容保存到应用私有目录的 `note.txt` 文件
- 从文件加载：从 `note.txt` 文件读取内容并显示到编辑框

### 2. SharedPreferences 设置模块
- 自动保存开关：控制是否自动保存账户密码
- 用户昵称设置：设置显示在主界面的用户名称
- 密码设置：保存用户密码（演示用途）
- 自动加载：根据设置自动执行文件操作

### 3. SQLite 数据库模块
- 记录管理：将文本内容保存为数据库记录
- 记录列表：显示所有保存的记录（标题和时间）
- 记录详情：查看记录的完整内容
- 记录删除：支持长按删除记录

## 技术实现

### 核心类说明

| 类名 | 功能描述 |
|------|----------|
| `MainActivity` | 主界面，集成所有功能 |
| `SettingsActivity` | 设置界面，管理用户偏好 |
| `RecordListActivity` | 记录列表界面 |
| `RecordDetailActivity` | 记录详情界面 |
| `MyDbHelper` | 数据库帮助类，继承 SQLiteOpenHelper |
| `RecordDao` | 数据库操作类，实现 CRUD 操作 |
| `Record` | 数据模型类 |

### 数据库设计

**表名：** `records`

| 字段名 | 类型 | 说明 |
|--------|------|------|
| `_id` | INTEGER | 主键，自增 |
| `title` | TEXT | 记录标题（内容前10字符） |
| `content` | TEXT | 记录完整内容 |
| `time` | TEXT | 创建时间戳 |

## 测试步骤

### 测试环境准备
1. 安装并运行应用
2. 确保应用正常启动，显示主界面
3. 确认所有界面元素正常显示

### 测试用例 1：文件读写功能

#### 步骤 1.1：保存文本到文件
1. 在主界面编辑框中输入测试文本：
   ```
   这是一个测试文本，用于验证文件存储功能。
   当前时间：2024年1月1日
   ```
2. 点击"保存到文件"按钮
3. **预期结果**：显示"内容已保存到文件"的Toast提示

#### 步骤 1.2：从文件加载文本
1. 清空编辑框内容
2. 点击"从文件加载"按钮
3. **预期结果**：
   - 编辑框中显示之前保存的文本
   - 显示"内容已从文件加载"的Toast提示

#### 步骤 1.3：文件不存在测试
1. 卸载应用重新安装（或清除应用数据）
2. 直接点击"从文件加载"按钮
3. **预期结果**：显示"文件不存在或读取失败"的Toast提示

### 测试用例 2：SharedPreferences 功能

#### 步骤 2.1：设置用户信息
1. 点击右上角菜单 → "设置"
2. 在设置界面中：
   - 勾选"自动保存账户密码"
   - 在用户昵称中输入："测试用户"
   - 在密码中输入："test123"
3. 点击"保存设置"按钮
4. **预期结果**：
   - 显示"设置保存成功"的Toast提示
   - 自动返回主界面
   - 主界面标题显示"欢迎, 测试用户!"

#### 步骤 2.2：验证设置持久化
1. 完全退出应用（从最近任务中划掉）
2. 重新启动应用
3. **预期结果**：
   - 主界面标题仍然显示"欢迎, 测试用户!"
   - 进入设置界面，确认设置值仍然存在

#### 步骤 2.3：测试自动保存功能
1. 确保"自动保存账户密码"已开启
2. 在主界面输入一些文本
3. 直接返回桌面（不手动保存）
4. 重新打开应用
5. **预期结果**：文本内容自动恢复

### 测试用例 3：SQLite 数据库功能

#### 步骤 3.1：保存记录到数据库
1. 在主界面编辑框中输入：
   ```
   这是我的第一条数据库记录。
   这里可以记录重要的笔记和想法。
   ```
2. 点击"保存为记录"按钮
3. **预期结果**：
   - 显示"记录保存成功，ID: [数字]"的Toast提示
   - 编辑框自动清空

#### 步骤 3.2：查看记录列表
1. 点击右上角菜单 → "记录列表"
2. **预期结果**：
   - 进入记录列表界面
   - 显示刚才保存的记录，包含标题和时间
   - 标题应为内容的前10个字符+"..."

#### 步骤 3.3：查看记录详情
1. 在记录列表界面，点击任意记录项
2. **预期结果**：
   - 进入记录详情界面
   - 显示完整的记录内容
   - 显示正确的创建时间

#### 步骤 3.4：删除记录
1. 在记录列表界面，长按任意记录项
2. **预期结果**：
   - 显示"记录已删除: [标题]"的Toast提示
   - 该记录从列表中消失

#### 步骤 3.5：数据持久化测试
1. 保存几条记录到数据库
2. 完全退出并重新启动应用
3. 进入记录列表界面
4. **预期结果**：所有记录仍然存在，数据持久化成功

### 测试用例 4：综合功能测试

#### 步骤 4.1：完整工作流程
1. 设置用户信息（昵称："综合测试"）
2. 输入多段文本，分别使用：
   - 保存到文件
   - 保存为记录
3. 验证所有数据都能正确保存和加载
4. **预期结果**：所有功能正常工作，数据不丢失

#### 步骤 4.2：边界测试
1. 测试空内容保存
2. 测试超长文本（1000+字符）
3. 测试特殊字符内容
4. **预期结果**：应用稳定，无崩溃现象

## 预期测试结果总结

| 功能模块 | 测试项目 | 预期结果 | 状态 |
|----------|----------|----------|------|
| 文件存储 | 保存到文件 | 成功保存，有提示 | ✅ |
| 文件存储 | 从文件加载 | 成功加载，内容正确 | ✅ |
| SharedPreferences | 设置保存 | 设置持久化，重启有效 | ✅ |
| SharedPreferences | 自动保存 | 根据设置自动执行操作 | ✅ |
| SQLite数据库 | 新增记录 | 成功保存，ID正确 | ✅ |
| SQLite数据库 | 查询记录 | 列表显示正确，详情完整 | ✅ |
| SQLite数据库 | 删除记录 | 成功删除，列表更新 | ✅ |
| 综合功能 | 数据持久化 | 重启应用数据不丢失 | ✅ |

## 问题排查指南

### 常见问题及解决方案

1. **应用崩溃**
   - 检查所有布局文件中的ID是否与代码中一致
   - 确认所有Activity已在AndroidManifest.xml中注册

2. **数据库操作失败**
   - 检查数据库表结构是否正确
   - 确认有存储权限

3. **文件读写失败**
   - 检查文件名和路径
   - 确认文件操作权限

4. **设置不保存**
   - 检查SharedPreferences的key值
   - 确认使用了`editor.apply()`或`editor.commit()`

## 项目结构
```
app/
├── java/com.example.notepadapp/
│   ├── MainActivity.java
│   ├── SettingsActivity.java
│   ├── RecordListActivity.java
│   ├── RecordDetailActivity.java
│   ├── MyDbHelper.java
│   ├── RecordDao.java
│   └── Record.java
├── res/
│   ├── layout/
│   │   ├── activity_main.xml
│   │   ├── activity_settings.xml
│   │   ├── activity_record_list.xml
│   │   ├── activity_record_detail.xml
│   │   └── item_record.xml
│   └── menu/
│       └── main_menu.xml
└── manifests/
    └── AndroidManifest.xml
```
