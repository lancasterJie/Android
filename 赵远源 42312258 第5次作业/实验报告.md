# Android ListView 实验报告：待办事项清单应用
姓名：赵远源

学号：42312258

## 一、实验目的
掌握 Android ListView 组件的使用方法，理解自定义适配器（Adapter）的工作原理，实现完整的任务管理应用。

## 二、实验内容

### 1. 基础列表展示功能
**实现文件：** `MainActivity.java`, `TaskAdapter.java`, `TaskItem.java`

**功能描述：**
- 使用 ListView 展示待办事项列表
- 每个列表项显示任务名称和截止日期
- 创建自定义适配器 或 ：ArrayAdapterBaseAdapter
- 初始化示例数据进行展示

**核心代码：**
```java
// TaskItem 数据模型
public class TaskItem {
    private String taskName;
    private String dueDate;
    private boolean isCompleted;
    
    public TaskItem(String taskName, String dueDate) {
        this.taskName = taskName;
        this.dueDate = dueDate;
        this.isCompleted = false;
    }
    // getter/setter 方法...
}

// TaskAdapter 适配器
public class TaskAdapter extends BaseAdapter {
    @Override
    public View getView(int position, View convertView, ViewGroup parent) {
        ViewHolder holder;
        if (convertView == null) {
            convertView = inflater.inflate(R.layout.list_item_task, parent, false);
            holder = new ViewHolder();
            holder.taskNameTextView = convertView.findViewById(R.id.textViewTaskName);
            holder.dueDateTextView = convertView.findViewById(R.id.textViewDueDate);
            holder.checkBoxCompleted = convertView.findViewById(R.id.checkBoxCompleted);
            convertView.setTag(holder);
        } else {
            holder = (ViewHolder) convertView.getTag();
        }
        
        TaskItem currentTask = taskList.get(position);
        holder.taskNameTextView.setText(currentTask.getTaskName());
        holder.dueDateTextView.setText("截止日期: " + currentTask.getDueDate());
        holder.checkBoxCompleted.setChecked(currentTask.isCompleted());
        
        return convertView;
    }
    
    static class ViewHolder {
        TextView taskNameTextView;
        TextView dueDateTextView;
        CheckBox checkBoxCompleted;
    }
}

// MainActivity 初始化
private void initData() {
    taskList = new ArrayList<>();
    taskList.add(new TaskItem("Complete Android Homework", "2025-12-20"));
    taskList.add(new TaskItem("Buy groceries", "2024-05-01"));
    taskList.add(new TaskItem("Walk the dog", "2024-04-20"));
    taskList.add(new TaskItem("Call John", "2024-04-23"));
}
```

### 2. 添加任务功能
**实现文件：** `MainActivity.java`, `dialog_add_edit_task.xml`

**功能描述：**
- 底部提供"添加任务"按钮
- 点击按钮弹出对话框
- 对话框包含任务名称和截止日期输入框
- 实现输入验证（非空检查）
- 添加成功后刷新列表并显示提示

**核心代码：**
```java
private void showAddTaskDialog() {
    AlertDialog.Builder builder = new AlertDialog.Builder(this);
    builder.setTitle("添加新任务");
    
    // 加载自定义布局
    View dialogView = LayoutInflater.from(this)
        .inflate(R.layout.dialog_add_edit_task, null);
    TextInputEditText editTextTaskName = dialogView.findViewById(R.id.editTextTaskName);
    TextInputEditText editTextDueDate = dialogView.findViewById(R.id.editTextDueDate);
    
    builder.setView(dialogView);
    
    builder.setPositiveButton("添加", (dialog, which) -> {
        String taskName = editTextTaskName.getText().toString().trim();
        String dueDate = editTextDueDate.getText().toString().trim();
        
        // 输入验证
        if (taskName.isEmpty()) {
            Toast.makeText(this, "任务名称不能为空", Toast.LENGTH_SHORT).show();
            return;
        }
        if (dueDate.isEmpty()) {
            Toast.makeText(this, "截止日期不能为空", Toast.LENGTH_SHORT).show();
            return;
        }
        
        // 添加新任务
        TaskItem newTask = new TaskItem(taskName, dueDate);
        taskList.add(newTask);
        taskAdapter.notifyDataSetChanged();
        Toast.makeText(this, "任务添加成功", Toast.LENGTH_SHORT).show();
    });
    
    builder.setNegativeButton("取消", (dialog, which) -> dialog.dismiss());
    builder.create().show();
}
```

### 3. 编辑任务功能
**实现文件：** `MainActivity.java`

**功能描述：**
- 点击列表项触发编辑功能
- 复用添加任务的对话框布局
- 对话框自动填充当前任务数据
- 支持修改任务名称和截止日期
- 保存后实时更新列表显示

**核心代码：**
```java
// 设置列表项点击事件
private void setListViewItemClickListener() {
    listViewTasks.setOnItemClickListener((parent, view, position, id) -> {
        showEditTaskDialog(position);
    });
}

// 编辑任务对话框
private void showEditTaskDialog(int position) {
    TaskItem task = taskList.get(position);
    
    AlertDialog.Builder builder = new AlertDialog.Builder(this);
    builder.setTitle("编辑任务");
    
    View dialogView = LayoutInflater.from(this)
        .inflate(R.layout.dialog_add_edit_task, null);
    TextInputEditText editTextTaskName = dialogView.findViewById(R.id.editTextTaskName);
    TextInputEditText editTextDueDate = dialogView.findViewById(R.id.editTextDueDate);
    
    // 预填充当前任务数据
    editTextTaskName.setText(task.getTaskName());
    editTextDueDate.setText(task.getDueDate());
    
    builder.setView(dialogView);
    
    builder.setPositiveButton("保存", (dialog, which) -> {
        String taskName = editTextTaskName.getText().toString().trim();
        String dueDate = editTextDueDate.getText().toString().trim();
        
        if (taskName.isEmpty() || dueDate.isEmpty()) {
            Toast.makeText(this, "输入不能为空", Toast.LENGTH_SHORT).show();
            return;
        }
        
        // 更新任务
        task.setTaskName(taskName);
        task.setDueDate(dueDate);
        taskAdapter.notifyDataSetChanged();
        Toast.makeText(this, "任务更新成功", Toast.LENGTH_SHORT).show();
    });
    
    builder.setNegativeButton("取消", (dialog, which) -> dialog.dismiss());
    builder.create().show();
}
```

### 4. 删除任务功能
**实现文件：** `MainActivity.java`

**功能描述：**
- 长按列表项触发删除功能
- 弹出确认对话框防止误删
- 对话框显示要删除的任务名称
- 确认后从列表中移除任务
- 删除后显示提示信息

**核心代码：**
```java
// 设置列表项长按事件
private void setListViewItemLongClickListener() {
    listViewTasks.setOnItemLongClickListener((parent, view, position, id) -> {
        showDeleteConfirmDialog(position);
        return true;  // 消费长按事件
    });
}

// 删除确认对话框
private void showDeleteConfirmDialog(int position) {
    TaskItem task = taskList.get(position);
    
    new AlertDialog.Builder(this)
        .setTitle("删除任务")
        .setMessage("确定要删除任务 \"" + task.getTaskName() + "\" 吗？")
        .setPositiveButton("删除", (dialog, which) -> {
            taskList.remove(position);
            taskAdapter.notifyDataSetChanged();
            Toast.makeText(this, "任务已删除", Toast.LENGTH_SHORT).show();
        })
        .setNegativeButton("取消", (dialog, which) -> dialog.dismiss())
        .show();
}
```


### 5. 任务完成状态标记
**实现文件：** `TaskAdapter.java`, `MainActivity.java`

**功能描述：**
- 每个列表项左侧显示 CheckBox
- 点击 CheckBox 切换任务完成状态
- 已完成任务显示删除线和灰色文字
- 未完成任务显示正常黑色文字
- 状态变化时显示提示信息

**核心代码：**
```java
// TaskAdapter 中的视觉反馈
if (currentTask.isCompleted()) {
    // 添加删除线
    holder.taskNameTextView.setPaintFlags(
        holder.taskNameTextView.getPaintFlags() | Paint.STRIKE_THRU_TEXT_FLAG);
    // 文字变灰
    holder.taskNameTextView.setTextColor(
        context.getResources().getColor(android.R.color.darker_gray));
} else {
    // 移除删除线
    holder.taskNameTextView.setPaintFlags(
        holder.taskNameTextView.getPaintFlags() & (~Paint.STRIKE_THRU_TEXT_FLAG));
    // 文字变黑
    holder.taskNameTextView.setTextColor(
        context.getResources().getColor(android.R.color.black));
}

// CheckBox 点击事件
holder.checkBoxCompleted.setOnClickListener(v -> {
    boolean isChecked = ((CheckBox) v).isChecked();
    currentTask.setCompleted(isChecked);
    if (statusChangeListener != null) {
        statusChangeListener.onTaskStatusChanged(position, isChecked);
    }
    notifyDataSetChanged();
});

// MainActivity 中设置状态变化监听器
taskAdapter.setOnTaskStatusChangeListener((position, isCompleted) -> {
    String status = isCompleted ? "已完成" : "未完成";
    Toast.makeText(this, "任务状态已更新: " + status, Toast.LENGTH_SHORT).show();
});
```



## 三、界面设计

### 1. MainActivity（主界面）
- **Toolbar 标题栏**：显示"待办事项清单"
- **ListView**：展示所有任务列表
- **添加任务按钮**：固定在屏幕底部，绿色背景
- **列表项布局**：CheckBox + 任务名称 + 截止日期

### 2. 对话框布局（添加/编辑任务）
- **标题**：根据操作显示"添加新任务"或"编辑任务"
- **任务名称输入框**：TextInputLayout + TextInputEditText
- **截止日期输入框**：TextInputLayout + TextInputEditText
- **按钮**：确定（添加/保存）、取消

### 3. 列表项布局（list_item_task.xml）
- **水平 LinearLayout**：根布局
- **CheckBox**：左侧，用于标记完成状态
- **垂直 LinearLayout**：包含任务信息
  - **任务名称 TextView**：18sp，粗体
  - **截止日期 TextView**：14sp，灰色

## 四、技术要点

### 1. ListView 和 Adapter
- 使用 `BaseAdapter` 自定义适配器实现数据绑定
- 适配器负责将数据源（ArrayList）转换为列表项视图
- 实现 `getCount()`, `getItem()`, `getItemId()`, `getView()` 四个核心方法

### 2. ViewHolder 模式
- 创建 ViewHolder 静态内部类缓存视图引用
- 在 `getView()` 中复用 convertView 避免重复创建视图
- 显著提升列表滚动性能，减少 `findViewById()` 调用

### 3. AlertDialog 对话框
- 使用 `AlertDialog.Builder` 建造者模式创建对话框
- 通过 `LayoutInflater.inflate()` 加载自定义布局
- 支持 `setPositiveButton()` 和 `setNegativeButton()` 设置按钮

### 4. 事件处理
- **点击事件**（`OnItemClickListener`）：用于编辑任务
- **长按事件**（`OnItemLongClickListener`）：用于删除任务
- **CheckBox 点击**：用于切换完成状态
- 长按事件返回 `true` 消费事件，避免触发点击事件

### 5. 数据验证
- 在添加和编辑时进行非空验证
- 验证失败时使用 Toast 显示错误提示
- 使用 `return` 阻止无效数据提交

### 6. 监听器模式
- 定义 `OnTaskStatusChangeListener` 接口实现状态变化回调
- 适配器通过监听器通知 Activity 状态变化
- 实现数据层和视图层的解耦

## 五、额外功能

1. **完成状态视觉反馈**：已完成任务显示删除线和灰色文字
2. **输入验证**：添加和编辑时进行非空检查
3. **删除确认**：删除前弹出确认对话框防止误操作
4. **对话框复用**：添加和编辑共用同一对话框布局
5. **Material Design**：使用 TextInputLayout 提供浮动标签效果
6. **Toast 提示**：所有操作都有即时反馈提示

## 六、实验总结

本实验完整实现了基于 ListView 的待办事项清单应用，掌握了以下核心技术：

1. **ListView 使用**：理解了 ListView 的工作原理和数据绑定机制
2. **自定义 Adapter**：掌握了 BaseAdapter 的实现和 ViewHolder 优化模式
3. **CRUD 操作**：实现了完整的增删改查功能
4. **事件处理**：掌握了多种事件类型的处理方法
5. **对话框交互**：学会了使用 AlertDialog 创建自定义对话框
6. **用户体验**：通过视觉反馈和操作提示提升用户体验
##七. 运行结果
<img width="360" height="724" alt="image" src="https://github.com/user-attachments/assets/c94cb87d-4385-4f50-b597-9fa125e9f802" />
<img width="364" height="730" alt="image" src="https://github.com/user-attachments/assets/bfea2009-71e7-48c6-8504-d989949f6ba6" />



通过本实验，深入理解了 Android 列表组件的使用和数据管理，为开发更复杂的应用打下了坚实基础。

